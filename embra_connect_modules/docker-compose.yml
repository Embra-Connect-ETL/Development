version: "3.3"

services:
  ec_firewall:
    image: embraconnect/ec_firewall:latest
    restart: unless-stopped
    ports:
      - "8082:8082"
    networks:
      - ec_network
    environment:
      INFISICAL_UNIVERSAL_CLIENT_ID: ${INFISICAL_UNIVERSAL_CLIENT_ID}
      INFISICAL_UNIVERSAL_CLIENT_SECRET: ${INFISICAL_UNIVERSAL_CLIENT_SECRET}
      INFISICAL_PROJECT_ID: ${INFISICAL_PROJECT_ID}
      INFISICAL_SITE_URL: ${INFISICAL_SITE_URL}

  ec_gateway:
    image: embraconnect/ec_gateway:latest
    restart: unless-stopped
    ports:
      - "8081:8081"
    networks:
      - ec_network
    environment:
      INFISICAL_UNIVERSAL_CLIENT_ID: ${INFISICAL_UNIVERSAL_CLIENT_ID}
      INFISICAL_UNIVERSAL_CLIENT_SECRET: ${INFISICAL_UNIVERSAL_CLIENT_SECRET}
      INFISICAL_PROJECT_ID: ${INFISICAL_PROJECT_ID}
      INFISICAL_SITE_URL: ${INFISICAL_SITE_URL}

  ec_access_control:
    image: embraconnect/ec_access_control:latest
    restart: unless-stopped
    depends_on:
      - ec_gateway
    ports:
      - "8800:8800"
    networks:
      - ec_network
    environment:
      INFISICAL_UNIVERSAL_CLIENT_ID: ${INFISICAL_UNIVERSAL_CLIENT_ID}
      INFISICAL_UNIVERSAL_CLIENT_SECRET: ${INFISICAL_UNIVERSAL_CLIENT_SECRET}
      INFISICAL_PROJECT_ID: ${INFISICAL_PROJECT_ID}
      INFISICAL_SITE_URL: ${INFISICAL_SITE_URL}

  ec_connect_ide:
    image: embraconnect/ec_connect_ide:latest
    restart: unless-stopped
    depends_on:
      - ec_access_control
    ports:
      - "7000:7000"
    networks:
      - ec_network
    environment:
      INFISICAL_UNIVERSAL_CLIENT_ID: ${INFISICAL_UNIVERSAL_CLIENT_ID}
      INFISICAL_UNIVERSAL_CLIENT_SECRET: ${INFISICAL_UNIVERSAL_CLIENT_SECRET}
      INFISICAL_PROJECT_ID: ${INFISICAL_PROJECT_ID}
      INFISICAL_SITE_URL: ${INFISICAL_SITE_URL}

  ec_client:
    image: embraconnect/ec_client:latest
    restart: unless-stopped
    depends_on:
      - ec_connect_ide
    ports:
      - "8000:8000"
    networks:
      - ec_network
    environment:
      INFISICAL_UNIVERSAL_CLIENT_ID: ${INFISICAL_UNIVERSAL_CLIENT_ID}
      INFISICAL_UNIVERSAL_CLIENT_SECRET: ${INFISICAL_UNIVERSAL_CLIENT_SECRET}
      INFISICAL_PROJECT_ID: ${INFISICAL_PROJECT_ID}
      INFISICAL_SITE_URL: ${INFISICAL_SITE_URL}

networks:
  ec_network:
    driver: bridge
